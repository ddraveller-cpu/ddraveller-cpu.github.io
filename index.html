<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜²çŒæ­»å°åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        deep: {
                            900: '#0f172a', // æ·±é‚ƒçš„åˆå¤œè“
                            800: '#1e293b', // ç¨æµ…çš„è“ç°
                        },
                        accent: {
                            light: '#38bdf8', // å¤©ç©ºè“
                            DEFAULT: '#0ea5e9', // æµ·æ´‹è“
                            dark: '#0284c7', // æ·±æµ·è“
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            overflow: hidden; /* é˜²æ­¢èƒŒæ™¯åŠ¨ç”»å¯¼è‡´æ»šåŠ¨æ¡ */
        }

        /* ç»ç’ƒæ‹Ÿæ€æ•ˆæœ */
        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* å‘¼å¸åœ†ç¯åŠ¨ç”» */
        .breathing-circle {
            transition: transform 0.1s linear, opacity 0.3s ease;
            box-shadow: 0 0 60px rgba(14, 165, 233, 0.3);
        }

        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.1s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* éšè—æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
    </style>
</head>
<body class="text-white min-h-screen flex items-center justify-center relative selection:bg-accent selection:text-white">

    <!-- èƒŒæ™¯è£…é¥°ï¼šæŸ”å’Œçš„åŠ¨æ€å…‰æ–‘ -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-accent/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-32 left-1/3 w-96 h-96 bg-pink-500/20 rounded-full mix-blend-screen filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <main class="w-full max-w-md p-6 relative z-10">
        
        <!-- ç»ç’ƒæ‹Ÿæ€å¡ç‰‡ -->
        <div class="glass-panel rounded-3xl p-8 flex flex-col items-center justify-center text-center space-y-8">
            
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <div class="w-full flex justify-between items-center text-gray-400 text-sm font-medium px-2">
                <span id="cycle-counter">å¾ªç¯: 0 / 0</span>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse" id="status-dot"></span>
                    <span id="status-text">å‡†å¤‡å°±ç»ª</span>
                </div>
            </div>

            <!-- æ ¸å¿ƒè§†è§‰åŒºï¼šåœ†ç¯ä¸æ–‡å­— -->
            <div class="relative w-64 h-64 flex items-center justify-center">
                
                <!-- SVG è¿›åº¦æ¡èƒŒæ™¯ -->
                <svg class="absolute w-full h-full z-20" viewBox="0 0 100 100">
                    <circle class="text-gray-600 stroke-current" stroke-width="4" cx="50" cy="50" r="45" fill="transparent"></circle>
                    <circle 
                        id="progress-ring"
                        class="text-accent-dark progress-ring__circle stroke-current" 
                        stroke-width="4" 
                        stroke-linecap="round" 
                        cx="50" cy="50" r="45" 
                        fill="transparent" 
                        stroke-dasharray="283" 
                        stroke-dashoffset="283">
                    </circle>
                </svg>

                <!-- å‘¼å¸åœ†ç¯ (è§†è§‰ä¸»ä½“) -->
                <div id="breath-visual" class="breathing-circle w-40 h-40 rounded-full bg-gradient-to-br from-accent-light to-accent-dark opacity-80 flex items-center justify-center relative z-10">
                    <!-- å†…éƒ¨æ–‡å­— -->
                    <div class="flex flex-col items-center">
                        <span id="instruction-text" class="text-2xl font-bold tracking-widest text-white drop-shadow-md">å¼€å§‹</span>
                        <span id="timer-text" class="text-4xl font-light mt-1 text-white/90">--</span>
                    </div>
                </div>
            </div>

            <!-- è®¾ç½®ä¸æ§åˆ¶åŒº -->
            <div class="w-full space-y-6">
                
                <!-- è®¾ç½®æ»‘å— (æ”¶èµ·/å±•å¼€) -->
                <div id="settings-panel" class="hidden transition-all duration-300 ease-in-out">
                    <div class="space-y-4 bg-deep-900/50 p-4 rounded-xl border border-white/5">
                        <div class="flex justify-between items-center text-sm">
                            <label class="text-gray-300">å¸æ°”æ—¶é•¿ (ç§’)</label>
                            <span id="inhale-val" class="font-mono text-accent">4</span>
                        </div>
                        <input type="range" id="inhale-input" min="2" max="10" value="4" class="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-accent">
                        
                        <div class="flex justify-between items-center text-sm">
                            <label class="text-gray-300">å±æ¯æ—¶é•¿ (ç§’)</label>
                            <span id="hold-val" class="font-mono text-accent">7</span>
                        </div>
                        <input type="range" id="hold-input" min="2" max="10" value="7" class="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-accent">
                        
                        <div class="flex justify-between items-center text-sm">
                            <label class="text-gray-300">å‘¼æ°”æ—¶é•¿ (ç§’)</label>
                            <span id="exhale-val" class="font-mono text-accent">8</span>
                        </div>
                        <input type="range" id="exhale-input" min="2" max="10" value="8" class="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-accent">
                        
                        <div class="flex justify-between items-center text-sm pt-2 border-t border-white/10">
                            <label class="text-gray-300">ç›®æ ‡å¾ªç¯æ¬¡æ•°</label>
                            <span id="cycle-val" class="font-mono text-accent">5</span>
                        </div>
                        <input type="range" id="cycle-input" min="1" max="20" value="5" class="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-accent">
                    </div>
                </div>

                <!-- æŒ‰é’®ç»„ -->
                <div class="flex gap-4 justify-center">
                    <button id="toggle-settings-btn" class="w-12 h-12 rounded-full bg-deep-800 hover:bg-deep-700 text-gray-400 hover:text-white transition-colors flex items-center justify-center border border-white/10 shadow-lg">
                        <i class="fas fa-sliders-h"></i>
                    </button>
                    
                    <button id="main-action-btn" class="flex-1 h-12 rounded-full bg-accent hover:bg-accent-light text-white font-semibold text-lg shadow-lg shadow-accent/30 transition-all transform hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2">
                        <i class="fas fa-play"></i>
                        <span id="btn-text">å¼€å§‹ç»ƒä¹ </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨æç¤º -->
        <p class="text-center text-gray-500 text-xs mt-6">
            è·Ÿéšåœ†ç¯çš„ç¼©æ”¾ä¸æ•°å­—çš„å€’æ•°è°ƒæ•´å‘¼å¸èŠ‚å¥
        <br/>
        <br/>
        <span style="float: right;">
            -- Written by Ding
        </span>
        </p>
    </main>

    <script>
        // é…ç½®ä¸çŠ¶æ€
        const config = {
            inhale: 4,
            hold: 7,
            exhale: 8,
            totalCycles: 5
        };

        const state = {
            isRunning: false,
            phase: 'idle', // idle, inhale, hold, exhale, hold2
            currentCycle: 0,
            timeLeft: 0,
            totalTimeInPhase: 0,
            timerId: null,
            animationFrameId: null,
            phaseStartTime: null
        };

        // DOM å…ƒç´ 
        const els = {
            btn: document.getElementById('main-action-btn'),
            btnText: document.getElementById('btn-text'),
            btnIcon: document.querySelector('#main-action-btn i'),
            settingsBtn: document.getElementById('toggle-settings-btn'),
            settingsPanel: document.getElementById('settings-panel'),
            instruction: document.getElementById('instruction-text'),
            timer: document.getElementById('timer-text'),
            visual: document.getElementById('breath-visual'),
            progressRing: document.getElementById('progress-ring'),
            statusText: document.getElementById('status-text'),
            statusDot: document.getElementById('status-dot'),
            cycleCounter: document.getElementById('cycle-counter'),
            inputs: {
                inhale: document.getElementById('inhale-input'),
                hold: document.getElementById('hold-input'),
                exhale: document.getElementById('exhale-input'),
                cycle: document.getElementById('cycle-input')
            },
            displays: {
                inhale: document.getElementById('inhale-val'),
                hold: document.getElementById('hold-val'),
                exhale: document.getElementById('exhale-val'),
                cycle: document.getElementById('cycle-val')
            }
        };

        // å¸¸é‡
        const CIRCLE_CIRCUMFERENCE = 2 * Math.PI * 45; // r=45

        // åˆå§‹åŒ–
        function init() {
            // ç»‘å®šäº‹ä»¶
            els.btn.addEventListener('click', toggleBreathing);
            els.settingsBtn.addEventListener('click', toggleSettings);
            
            // ç»‘å®šè¾“å…¥äº‹ä»¶
            Object.keys(els.inputs).forEach(key => {
                els.inputs[key].addEventListener('input', (e) => {
                    const val = parseInt(e.target.value);
                    config[key === 'cycle' ? 'totalCycles' : key] = val;
                    els.displays[key].textContent = val;
                    updateCycleDisplay();
                });
            });

            updateCycleDisplay();
            resetVisuals();
        }

        // åˆ‡æ¢è®¾ç½®é¢æ¿
        function toggleSettings() {
            els.settingsPanel.classList.toggle('hidden');
        }

        // æ›´æ–°å¾ªç¯è®¡æ•°æ˜¾ç¤º
        function updateCycleDisplay() {
            els.cycleCounter.textContent = `å¾ªç¯: ${state.currentCycle} / ${config.totalCycles}`;
        }

        // åˆ‡æ¢å¼€å§‹/æš‚åœ
        function toggleBreathing() {
            if (state.isRunning) {
                stopBreathing();
            } else {
                startBreathing();
            }
        }

        // å¼€å§‹å‘¼å¸é€»è¾‘
        function startBreathing() {
            if (state.currentCycle >= config.totalCycles) {
                resetSession();
            }

            state.isRunning = true;
            updateUIState(true);
            startPhase('inhale');
        }

        // åœæ­¢å‘¼å¸é€»è¾‘
        function stopBreathing() {
            state.isRunning = false;
            clearTimeout(state.timerId);
            cancelAnimationFrame(state.animationFrameId);
            state.phaseStartTime = null;
            updateUIState(false);
            els.instruction.textContent = "å·²æš‚åœ";
            els.timer.textContent = "--";
            els.statusText.textContent = "å·²æš‚åœ";
            els.statusDot.className = "w-2 h-2 rounded-full bg-yellow-500";
        }

        // é‡ç½®ä¼šè¯
        function resetSession() {
            state.currentCycle = 0;
            updateCycleDisplay();
        }

        // æ›´æ–°UIçŠ¶æ€ï¼ˆæŒ‰é’®ã€æ–‡å­—ï¼‰
        function updateUIState(isRunning) {
            if (isRunning) {
                els.btnText.textContent = "æš‚åœ";
                els.btnIcon.className = "fas fa-pause";
                els.btn.classList.replace('bg-accent', 'bg-red-500');
                els.btn.classList.replace('hover:bg-accent-light', 'hover:bg-red-600');
                els.btn.classList.replace('shadow-accent/30', 'shadow-red-500/30');
                els.settingsBtn.disabled = true;
                els.settingsBtn.classList.add('opacity-50', 'cursor-not-allowed');
                els.statusText.textContent = "ç»ƒä¹ ä¸­...";
                els.statusDot.className = "w-2 h-2 rounded-full bg-green-500 animate-pulse";
            } else {
                els.btnText.textContent = state.currentCycle > 0 ? "ç»§ç»­" : "å¼€å§‹ç»ƒä¹ ";
                els.btnIcon.className = "fas fa-play";
                els.btn.classList.replace('bg-red-500', 'bg-accent');
                els.btn.classList.replace('hover:bg-red-600', 'hover:bg-accent-light');
                els.btn.classList.replace('shadow-red-500/30', 'shadow-accent/30');
                els.settingsBtn.disabled = false;
                els.settingsBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // å¼€å§‹ç‰¹å®šé˜¶æ®µ
        function startPhase(phase) {
            state.phase = phase;
            state.phaseStartTime = null; // é‡ç½®æ—¶é—´è®°å½•ï¼Œåœ¨ runTimer ä¸­ä¼šè®¾ç½®æ­£ç¡®çš„å¼€å§‹æ—¶é—´
            
            // è®¾ç½®é˜¶æ®µæ—¶é•¿
            switch(phase) {
                case 'inhale':
                    state.timeLeft = config.inhale;
                    state.totalTimeInPhase = config.inhale;
                    els.instruction.textContent = "å¸æ°”";
                    els.instruction.className = "text-2xl font-bold tracking-widest text-white drop-shadow-md";
                    break;
                case 'hold':
                    state.timeLeft = config.hold;
                    state.totalTimeInPhase = config.hold;
                    els.instruction.textContent = "å±æ¯";
                    els.instruction.className = "text-2xl font-bold tracking-widest text-accent-light drop-shadow-md";
                    break;
                case 'exhale':
                    state.timeLeft = config.exhale;
                    state.totalTimeInPhase = config.exhale;
                    els.instruction.textContent = "å‘¼æ°”";
                    els.instruction.className = "text-2xl font-bold tracking-widest text-white drop-shadow-md";
                    break;
            }

            runTimer();
        }

        // è®¡æ—¶å™¨æ ¸å¿ƒé€»è¾‘
        function runTimer() {
            if (!state.isRunning) return;

            // è®°å½•é˜¶æ®µå¼€å§‹æ—¶é—´ï¼ˆå¦‚æœè¿˜æ²¡è®°å½•ï¼‰
            if (!state.phaseStartTime) {
                state.phaseStartTime = Date.now();
            }

            // è®¡ç®—ä»é˜¶æ®µå¼€å§‹ç»è¿‡çš„æ—¶é—´ï¼ˆç§’ï¼‰
            const elapsedTime = (Date.now() - state.phaseStartTime) / 1000;
            
            // è®¡ç®—å‰©ä½™æ—¶é—´ï¼ˆç”¨äºæ˜¾ç¤ºæ•´æ•°ç§’ï¼‰
            state.timeLeft = Math.max(0, Math.ceil(state.totalTimeInPhase - elapsedTime));

            // æ›´æ–°æ•°å­—æ˜¾ç¤º
            els.timer.textContent = state.timeLeft;

            // è®¡ç®—è¿›åº¦æ¯”ä¾‹ (0 åˆ° 1)ï¼ŒåŸºäºå®é™…ç»è¿‡çš„æ—¶é—´ï¼Œå®ç°å¹³æ»‘åŠ¨ç”»
            let progress = elapsedTime / state.totalTimeInPhase;
            progress = Math.min(progress, 1); // ç¡®ä¿ä¸è¶…è¿‡ 1
            
            // æ›´æ–°åœ†ç¯è¿›åº¦
            const offset = CIRCLE_CIRCUMFERENCE - (progress * CIRCLE_CIRCUMFERENCE);
            els.progressRing.style.strokeDashoffset = offset;

            // æ›´æ–°è§†è§‰åŠ¨ç”» (ç¼©æ”¾)
            updateVisuals(progress);

            if (elapsedTime < state.totalTimeInPhase) {
                state.animationFrameId = requestAnimationFrame(runTimer);
            } else {
                state.phaseStartTime = null; // é‡ç½®æ—¶é—´è®°å½•
                nextPhase();
            }
        }

        // æ›´æ–°è§†è§‰åœ†ç¯çš„å¤§å°å’Œé€æ˜åº¦
        function updateVisuals(progress) {
            let scale = 1;
            let opacity = 0.8;

            if (state.phase === 'inhale') {
                // 1 -> 1.4 (ä»¥åœ†ç¯å†…ä¾§ä¸ºå‚ç…§)
                scale = 1 + (progress * 0.4);
                opacity = 0.8 + (progress * 0.2);
            } else if (state.phase === 'hold') {
                // ä¿æŒ 1.4
                scale = 1.4;
                opacity = 1.0;
            } else if (state.phase === 'exhale') {
                // 1.4 -> 1
                scale = 1.4 - (progress * 0.4);
                opacity = 1.0 - (progress * 0.2);
            }

            els.visual.style.transform = `scale(${scale})`;
            els.visual.style.opacity = opacity;
        }

        // é˜¶æ®µåˆ‡æ¢é€»è¾‘
        function nextPhase() {
            if (state.phase === 'inhale') {
                startPhase('hold');
            } else if (state.phase === 'hold') {
                startPhase('exhale');
            } else if (state.phase === 'exhale') {
                state.currentCycle++;
                updateCycleDisplay();
                
                if (state.currentCycle >= config.totalCycles) {
                    completeSession();
                } else {
                    startPhase('inhale');
                }
            }
        }

        // å®Œæˆä¼šè¯
        function completeSession() {
            state.isRunning = false;
            updateUIState(false);
            els.instruction.textContent = "å®Œæˆ";
            els.timer.textContent = "ğŸ‰";
            els.statusText.textContent = "ç»ƒä¹ ç»“æŸ";
            els.statusDot.className = "w-2 h-2 rounded-full bg-blue-500";
            els.btnText.textContent = "é‡æ–°å¼€å§‹";
            resetVisuals();
        }

        // é‡ç½®è§†è§‰å…ƒç´ 
        function resetVisuals() {
            els.visual.style.transform = `scale(1)`;
            els.visual.style.opacity = `0.8`;
            els.progressRing.style.strokeDashoffset = CIRCLE_CIRCUMFERENCE;
        }

        // å¯åŠ¨
        init();

    </script>
</body>
</html>

